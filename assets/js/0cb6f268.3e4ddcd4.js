"use strict";(self.webpackChunkdeployer_docs=self.webpackChunkdeployer_docs||[]).push([[380],{4137:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>d});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),h=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},s=function(e){var t=h(e.components);return r.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),u=h(n),d=i,m=u["".concat(l,".").concat(d)]||u[d]||c[d]||a;return n?r.createElement(m,p(p({ref:t},s),{},{components:n})):r.createElement(m,p({ref:t},s))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,p=new Array(a);p[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:i,p[1]=o;for(var h=2;h<a;h++)p[h]=n[h];return r.createElement.apply(null,p)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},9231:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>p,default:()=>c,frontMatter:()=>a,metadata:()=>o,toc:()=>h});var r=n(7462),i=(n(7294),n(4137));const a={},p="Phinx Recipe",o={unversionedId:"contrib/phinx",id:"contrib/phinx",title:"Phinx Recipe",description:"Source",source:"@site/docs/contrib/phinx.md",sourceDirName:"contrib",slug:"/contrib/phinx",permalink:"/docs/7.x/contrib/phinx",draft:!1,editUrl:"https://github.com/deployphp/deployer/edit/master/docs/contrib/phinx.md",tags:[],version:"current",frontMatter:{},sidebar:"contrib",previous:{title:"Ntfy Recipe",permalink:"/docs/7.x/contrib/ntfy"},next:{title:"Php-fpm Recipe",permalink:"/docs/7.x/contrib/php-fpm"}},l={},h=[{value:"Configuration options",id:"configuration-options",level:2},{value:"Phinx params",id:"phinx-params",level:3},{value:"Phinx path params",id:"phinx-path-params",level:3},{value:"Example of usage",id:"example-of-usage",level:3},{value:"Suggested Usage",id:"suggested-usage",level:2},{value:"Read more",id:"read-more",level:2},{value:"Configuration",id:"configuration",level:2},{value:"bin/phinx",id:"binphinx",level:3},{value:"Tasks",id:"tasks",level:2},{value:"phinx:migrate",id:"phinxmigrate",level:3},{value:"phinx:rollback",id:"phinxrollback",level:3},{value:"phinx:seed",id:"phinxseed",level:3},{value:"phinx:breakpoint",id:"phinxbreakpoint",level:3}],s={toc:h};function c(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,r.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"phinx-recipe"},"Phinx Recipe"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"require 'contrib/phinx.php';\n")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/tree/master/contrib/phinx.php"},"Source")),(0,i.kt)("h2",{id:"configuration-options"},"Configuration options"),(0,i.kt)("p",null,"All options are in the config parameter ",(0,i.kt)("inlineCode",{parentName:"p"},"phinx")," specified as an array (instead of the ",(0,i.kt)("inlineCode",{parentName:"p"},"phinx_path")," variable).\nAll parameters are ",(0,i.kt)("em",{parentName:"p"},"optional"),", but you can specify them with a dictionary (to change all parameters)\nor by deployer dot notation (to change one option)."),(0,i.kt)("h3",{id:"phinx-params"},"Phinx params"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"phinx.environment")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"phinx.date")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"phinx.configuration")," N.B. current directory is the project directory"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"phinx.target")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"phinx.seed")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"phinx.parser")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"phinx.remove-all")," (pass empty string as value)")),(0,i.kt)("h3",{id:"phinx-path-params"},"Phinx path params"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"phinx_path")," Specify phinx path (by default phinx is searched for in $PATH, ./vendor/bin and ~/.composer/vendor/bin)")),(0,i.kt)("h3",{id:"example-of-usage"},"Example of usage"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"$phinx_env_vars = [\n  'environment' => 'development',\n  'configuration' => './migration/.phinx.yml',\n  'target' => '20120103083322',\n  'remove-all' => '',\n];\n\nset('phinx_path', '/usr/local/phinx/bin/phinx');\nset('phinx', $phinx_env_vars);\n\nafter('cleanup', 'phinx:migrate');\n\nor set it for a specific server\nhost('dev')\n    ->user('user')\n    ->set('deploy_path', '/var/www')\n    ->set('phinx', $phinx_env_vars)\n    ->set('phinx_path', '');\n")),(0,i.kt)("h2",{id:"suggested-usage"},"Suggested Usage"),(0,i.kt)("p",null,"You can run all tasks before or after any\ntasks (but you need to specify external configs for phinx).\nIf you use internal configs (which are in your project) you need\nto run it after the ",(0,i.kt)("inlineCode",{parentName:"p"},"deploy:update_code")," task is completed."),(0,i.kt)("h2",{id:"read-more"},"Read more"),(0,i.kt)("p",null,"For further reading see ",(0,i.kt)("a",{parentName:"p",href:"https://phinx.org"},"phinx.org"),". Complete descriptions of all possible options can be found on the ",(0,i.kt)("a",{parentName:"p",href:"http://docs.phinx.org/en/latest/commands.html"},"commands page"),"."),(0,i.kt)("h2",{id:"configuration"},"Configuration"),(0,i.kt)("h3",{id:"binphinx"},"bin/phinx"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/phinx.php#L80"},"Source")),(0,i.kt)("p",null,"Path to Phinx"),(0,i.kt)("admonition",{title:"Autogenerated",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"The value of this configuration is autogenerated on access.")),(0,i.kt)("h2",{id:"tasks"},"Tasks"),(0,i.kt)("h3",{id:"phinxmigrate"},"phinx:migrate"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/phinx.php#L148"},"Source")),(0,i.kt)("p",null,"Migrats database with phinx."),(0,i.kt)("h3",{id:"phinxrollback"},"phinx:rollback"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/phinx.php#L169"},"Source")),(0,i.kt)("p",null,"Rollbacks database migrations with phinx."),(0,i.kt)("h3",{id:"phinxseed"},"phinx:seed"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/phinx.php#L190"},"Source")),(0,i.kt)("p",null,"Seeds database with phinx."),(0,i.kt)("h3",{id:"phinxbreakpoint"},"phinx:breakpoint"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/phinx.php#L210"},"Source")),(0,i.kt)("p",null,"Sets a migrations breakpoint with phinx."))}c.isMDXComponent=!0}}]);