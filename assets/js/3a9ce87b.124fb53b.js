"use strict";(self.webpackChunkdeployer_docs=self.webpackChunkdeployer_docs||[]).push([[6877],{4137:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>N});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),m=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},s=function(e){var t=m(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},k=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),k=m(n),N=r,c=k["".concat(l,".").concat(N)]||k[N]||d[N]||i;return n?a.createElement(c,p(p({ref:t},s),{},{components:n})):a.createElement(c,p({ref:t},s))}));function N(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,p=new Array(i);p[0]=k;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,p[1]=o;for(var m=2;m<i;m++)p[m]=n[m];return a.createElement.apply(null,p)}return a.createElement.apply(null,n)}k.displayName="MDXCreateElement"},3175:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>p,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>m});var a=n(7462),r=(n(7294),n(4137));const i={},p="Upgrade a major version",o={unversionedId:"UPGRADE",id:"UPGRADE",title:"Upgrade a major version",description:"Upgrade from 6.x to 7.x",source:"@site/docs/UPGRADE.md",sourceDirName:".",slug:"/UPGRADE",permalink:"/docs/7.x/UPGRADE",draft:!1,editUrl:"https://github.com/deployphp/deployer/edit/master/docs/UPGRADE.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Avoid PHP-FPM Reloading",permalink:"/docs/7.x/avoid-php-fpm-reloading"},next:{title:"Known Bugs",permalink:"/docs/7.x/KNOWN_BUGS"}},l={},m=[{value:"Upgrade from 6.x to 7.x",id:"upgrade-from-6x-to-7x",level:2},{value:"Step 1: Update deploy.php",id:"step-1-update-deployphp",level:3},{value:"Step 2: Deploy",id:"step-2-deploy",level:3},{value:"Upgrade from 5.x to 6.x",id:"upgrade-from-5x-to-6x",level:2},{value:"Upgrade from 4.x to 5.x",id:"upgrade-from-4x-to-5x",level:2},{value:"Upgrade from 3.x to 4.x",id:"upgrade-from-3x-to-4x",level:2},{value:"Upgrade from 2.x to 3.x",id:"upgrade-from-2x-to-3x",level:2}],s={toc:m};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"upgrade-a-major-version"},"Upgrade a major version"),(0,r.kt)("h2",{id:"upgrade-from-6x-to-7x"},"Upgrade from 6.x to 7.x"),(0,r.kt)("h3",{id:"step-1-update-deployphp"},"Step 1: Update deploy.php"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Change config ",(0,r.kt)("inlineCode",{parentName:"p"},"hostname")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"alias"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Change config ",(0,r.kt)("inlineCode",{parentName:"p"},"real_hostname")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"hostname"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Change config ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"remote_user"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Update ",(0,r.kt)("inlineCode",{parentName:"p"},"host()")," definitions:"),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Add ",(0,r.kt)("inlineCode",{parentName:"li"},"set")," prefix to all setters: ",(0,r.kt)("inlineCode",{parentName:"li"},"identityFile")," -> ",(0,r.kt)("inlineCode",{parentName:"li"},"setIdentityFile")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"set('identity_file')")),(0,r.kt)("li",{parentName:"ol"},"Update ",(0,r.kt)("inlineCode",{parentName:"li"},"host(...)->addSshOption('UserKnownHostsFile', '/dev/null')")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"host(...)->setSshArguments(['-o UserKnownHostsFile=/dev/null']);")),(0,r.kt)("li",{parentName:"ol"},"Replace ",(0,r.kt)("em",{parentName:"li"},"stage")," with labels, i.e.",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"host('deployer.org')\n    ->set('labels', ['stage' => 'prod']);\n")),"When deploying instead of ",(0,r.kt)("inlineCode",{parentName:"li"},"dep deploy prod")," use ",(0,r.kt)("inlineCode",{parentName:"li"},"dep deploy stage=prod"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"alias()")," is deleted, ",(0,r.kt)("inlineCode",{parentName:"li"},"host()")," itself sets alias and hostname, to override hostname use ",(0,r.kt)("inlineCode",{parentName:"li"},"setHostname()"),"."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Update ",(0,r.kt)("inlineCode",{parentName:"p"},"task()")," definitions."),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"onRoles()")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"select()"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"task(...)\n    ->select('stage=prod');\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Don't use string-based task definition, it's not available anymore. Don't forget to set correct working directory."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"# from\ntask('deploy:npm-install', 'npm clean-install');\n\n# to\ntask('deploy:npm-install', function() {\n    cd('{{release_path}}');\n    run('npm clean-install');\n});\n"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Third party recipes now live inside main Deployer repo in ",(0,r.kt)("em",{parentName:"p"},"contrib"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"require 'contrib/rsync.php';\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"inventory()")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"import()"),". It now can import hosts, configs, tasks:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'import: recipe/common.php\n\nconfig:\n  application: deployer\n  shared_dirs:\n    - uploads\n    - storage/logs/\n    - storage/db\n  shared_files:\n    - .env\n    - config/test.yaml\n  keep_releases: 3\n  http_user: false\n\nhosts:\n  prod:\n    local: true\n\ntasks:\n  deploy:\n    - deploy:prepare\n    - deploy:vendors\n    - deploy:publish\n\n  deploy:vendors:\n    - run: "cd {{release_path}} && echo {{bin/composer}} {{composer_options}} 2>&1"\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Rename task ",(0,r.kt)("inlineCode",{parentName:"p"},"success")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"deploy:success")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"cleanup")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"deploy:cleanup"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Verbosity functions (",(0,r.kt)("inlineCode",{parentName:"p"},"isDebug()"),", etc) got deleted. Use ",(0,r.kt)("inlineCode",{parentName:"p"},"output()->isDebug()")," instead.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"runLocally()")," commands are executed relative to the recipe file directory. This behaviour can be overridden via an environment variable:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"DEPLOYER_ROOT=. vendor/bin/dep taskname`\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"local()")," tasks with combination of ",(0,r.kt)("inlineCode",{parentName:"p"},"once()")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"runLocally()")," func.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"locateBinaryPath()")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"which()")," func.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Configuration property ",(0,r.kt)("inlineCode",{parentName:"p"},"default_stage")," is not supported anymore and has been dropped.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"onHosts()")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"onStage()")," with ",(0,r.kt)("a",{parentName:"p",href:"/docs/7.x/selector"},"labels & selectors"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"setPrivate()")," with ",(0,r.kt)("a",{parentName:"p",href:"/docs/7.x/tasks#hidden"},(0,r.kt)("inlineCode",{parentName:"a"},"hidden()")),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Configuration property ",(0,r.kt)("inlineCode",{parentName:"p"},"writable_recursive")," defaults to ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),". This behaviour can be overridden with:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"set('writable_recursive', true);\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},".git")," directory is not present in release directory anymore. The previous behavior can be restored with:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"set('update_code_strategy', 'clone');\n")))),(0,r.kt)("h3",{id:"step-2-deploy"},"Step 2: Deploy"),(0,r.kt)("p",null,"Since the release history numbering is not compatible between v6 and v7, you need to specify the ",(0,r.kt)("inlineCode",{parentName:"p"},"release_name")," manually for the first time. Otherwise you start with release 1."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Find out next release name (ssh to the host, ",(0,r.kt)("inlineCode",{parentName:"li"},"ls")," releases dir, find the biggest number). Example: ",(0,r.kt)("inlineCode",{parentName:"li"},"42"),"."),(0,r.kt)("li",{parentName:"ol"},"Deploy with release_name:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"dep deploy -o release_name=43\n")))),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"In case a rollback is needed, manually change the ",(0,r.kt)("inlineCode",{parentName:"p"},"current")," symlink:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre"},"ln -nfs releases/42 current\n"))),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"In case there are multiple hosts with different release names, you should create a ",(0,r.kt)("inlineCode",{parentName:"p"},"{{deploy_path}}/.dep/latest_release")," file in each host with the current release number of that particular host.")),(0,r.kt)("h2",{id:"upgrade-from-5x-to-6x"},"Upgrade from 5.x to 6.x"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Changed branch option priority"),(0,r.kt)("p",{parentName:"li"},"If you have host definition with ",(0,r.kt)("inlineCode",{parentName:"p"},"branch(...)")," parameter, adding ",(0,r.kt)("inlineCode",{parentName:"p"},"--branch")," option will not override it any more.\nIf no ",(0,r.kt)("inlineCode",{parentName:"p"},"branch(...)")," parameter persists, branch will be fetched from current local git branch."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"host('prod')\n    ->set('branch', 'production')\n")),(0,r.kt)("p",{parentName:"li"},"In order to return to old behavior add checking of ",(0,r.kt)("inlineCode",{parentName:"p"},"--branch")," option."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"host('prod')\n    ->set('branch', function () {\n        return input()->getOption('branch') ?: 'production';\n    })\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add ",(0,r.kt)("inlineCode",{parentName:"p"},"deploy:info")," task to the beginning to ",(0,r.kt)("inlineCode",{parentName:"p"},"deploy")," task.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"run")," returns string instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"Deployer\\Type\\Result")),(0,r.kt)("p",{parentName:"li"},"Now ",(0,r.kt)("inlineCode",{parentName:"p"},"run")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"runLocally")," returns ",(0,r.kt)("inlineCode",{parentName:"p"},"string")," instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"Deployer\\Type\\Result"),".\nReplace method calls as:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"run('command')->toString()")," \u2192 ",(0,r.kt)("inlineCode",{parentName:"li"},"run('command')")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"run('if command; then echo \"true\"; fi;')->toBool()")," \u2192 ",(0,r.kt)("inlineCode",{parentName:"li"},"test('command')")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"env_vars")," renamed to ",(0,r.kt)("inlineCode",{parentName:"p"},"env")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"set('env_vars', 'FOO=bar');")," \u2192 ",(0,r.kt)("inlineCode",{parentName:"li"},"set('env', ['FOO' => 'bar']);"))),(0,r.kt)("p",{parentName:"li"},"If your are using Symfony recipe, then you need to change ",(0,r.kt)("inlineCode",{parentName:"p"},"env")," setting:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"set('env', 'prod');")," \u2192 ",(0,r.kt)("inlineCode",{parentName:"li"},"set('symfony_env', 'prod');"))))),(0,r.kt)("h2",{id:"upgrade-from-4x-to-5x"},"Upgrade from 4.x to 5.x"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Servers to Hosts"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"server($hostname)")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"host($hostname)"),", and ",(0,r.kt)("inlineCode",{parentName:"li"},"server($name, $hostname)")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"host($name)->hostname($hostname)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"localServer($name)")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"localhost()")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"cluster($name, $nodes, $port)")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"hosts(...$hodes)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"serverList($file)")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"inventory($file)"))),(0,r.kt)("p",{parentName:"li"},"If you need to deploy to same server use ",(0,r.kt)("a",{parentName:"p",href:"https://deployer.org/docs/hosts#host-aliases"},"host aliases"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"host('domain.com/green', 'domain.com/blue')\n    ->set('deploy_path', '~/{{hostname}}')\n    ...\n")),(0,r.kt)("p",{parentName:"li"},"Or you can define different hosts with same hostname:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"host('production')\n    ->hostname('domain.com')\n    ->set('deploy_path', '~/production')\n    ...\n\nhost('beta')\n    ->hostname('domain.com')\n    ->set('deploy_path', '~/beta')\n    ...\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Configuration options"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Rename ",(0,r.kt)("inlineCode",{parentName:"li"},"{{server.name}}")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"{{hostname}}")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"DotArray syntax"),(0,r.kt)("p",{parentName:"li"},"In v5 access to nested arrays in config via dot notation was removed.\nIf you was using it, consider to move to plain config options."),(0,r.kt)("p",{parentName:"li"},"Refactor this:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"set('a', ['b' => 1]);\n\n// ...\n\nget('a.b');\n")),(0,r.kt)("p",{parentName:"li"},"To:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"set('a_b', 1);\n\n// ...\n\nget('a_b');\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Credentials"),(0,r.kt)("p",{parentName:"li"},"Best practice in new v5 is to omit credentials for connection in ",(0,r.kt)("inlineCode",{parentName:"p"},"deploy.php")," and write them in ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.ssh/config")," instead."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"identityFile($publicKeyFile,, $privateKeyFile, $passPhrase)")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"identityFile($privateKeyFile)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"pemFile($pemFile)")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"identityFile($pemFile)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"forwardAgent()")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"forwardAgent(true)")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Tasks constraints"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"onlyOn")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"onHosts")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"onlyOnStage")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"onStage"))))),(0,r.kt)("h2",{id:"upgrade-from-3x-to-4x"},"Upgrade from 3.x to 4.x"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Namespace for functions"),(0,r.kt)("p",{parentName:"li"},"Add to beginning of ",(0,r.kt)("em",{parentName:"p"},"deploy.php")," next line:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"use function Deployer\\{server, task, run, set, get, add, before, after};\n")),(0,r.kt)("p",{parentName:"li"},"If you are using PHP version less than 5.6, you can use this:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"namespace Deployer;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"env()")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"set()"),"/",(0,r.kt)("inlineCode",{parentName:"p"},"get()")),(0,r.kt)("p",{parentName:"li"},"Rename all calls ",(0,r.kt)("inlineCode",{parentName:"p"},"env($name, $value)")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"set($name, $value)"),"."),(0,r.kt)("p",{parentName:"li"},"Rename all rvalue ",(0,r.kt)("inlineCode",{parentName:"p"},"env($name)")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"get($name)"),"."),(0,r.kt)("p",{parentName:"li"},"Rename all ",(0,r.kt)("inlineCode",{parentName:"p"},"server(...)->env(...)")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"server(...)->set(...)"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Moved ",(0,r.kt)("em",{parentName:"p"},"NonFatalException")),(0,r.kt)("p",{parentName:"li"},"Rename ",(0,r.kt)("inlineCode",{parentName:"p"},"Deployer\\Task\\NonFatalException")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"Deployer\\Exception\\NonFatalException"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Prior release cleanup"),(0,r.kt)("p",{parentName:"li"},"Due to changes in release management, the new cleanup task will ignore any prior releases deployed with 3.x. These will need to be manually removed after migrating to and successfully releasing via 4.x."))),(0,r.kt)("h2",{id:"upgrade-from-2x-to-3x"},"Upgrade from 2.x to 3.x"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("h3",{parentName:"li",id:"-path"},(0,r.kt)("inlineCode",{parentName:"h3"},"->path('...')")),(0,r.kt)("p",{parentName:"li"},"Replace your server paths configuration:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"server(...)\n  ->path(...);\n")),(0,r.kt)("p",{parentName:"li"},"to:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"server(...)\n  ->env('deploy_path', '...');\n")))))}d.isMDXComponent=!0}}]);