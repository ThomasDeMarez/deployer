"use strict";(self.webpackChunkdeployer_docs=self.webpackChunkdeployer_docs||[]).push([[3821],{4137:(e,t,o)=>{o.d(t,{Zo:()=>h,kt:()=>d});var a=o(7294);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function l(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function c(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?l(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function n(e,t){if(null==e)return{};var o,a,r=function(e,t){if(null==e)return{};var o,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)o=l[a],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)o=l[a],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var p=a.createContext({}),i=function(e){var t=a.useContext(p),o=t;return e&&(o="function"==typeof e?e(t):c(c({},t),e)),o},h=function(e){var t=i(e.components);return a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},s=a.forwardRef((function(e,t){var o=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,h=n(e,["components","mdxType","originalType","parentName"]),s=i(o),d=r,m=s["".concat(p,".").concat(d)]||s[d]||u[d]||l;return o?a.createElement(m,c(c({ref:t},h),{},{components:o})):a.createElement(m,c({ref:t},h))}));function d(e,t){var o=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=o.length,c=new Array(l);c[0]=s;var n={};for(var p in t)hasOwnProperty.call(t,p)&&(n[p]=t[p]);n.originalType=e,n.mdxType="string"==typeof e?e:r,c[1]=n;for(var i=2;i<l;i++)c[i]=o[i];return a.createElement.apply(null,c)}return a.createElement.apply(null,o)}s.displayName="MDXCreateElement"},1833:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>p,contentTitle:()=>c,default:()=>u,frontMatter:()=>l,metadata:()=>n,toc:()=>i});var a=o(7462),r=(o(7294),o(4137));const l={},c="Cachetool Recipe",n={unversionedId:"contrib/cachetool",id:"contrib/cachetool",title:"Cachetool Recipe",description:"Source",source:"@site/docs/contrib/cachetool.md",sourceDirName:"contrib",slug:"/contrib/cachetool",permalink:"/docs/7.x/contrib/cachetool",draft:!1,editUrl:"https://github.com/deployphp/deployer/edit/master/docs/contrib/cachetool.md",tags:[],version:"current",frontMatter:{},sidebar:"contrib",previous:{title:"Bugsnag Recipe",permalink:"/docs/7.x/contrib/bugsnag"},next:{title:"Chatwork Recipe",permalink:"/docs/7.x/contrib/chatwork"}},p={},i=[{value:"Configuration",id:"configuration",level:2},{value:"Usage",id:"usage",level:2},{value:"Read more",id:"read-more",level:2},{value:"Configuration",id:"configuration-1",level:2},{value:"cachetool",id:"cachetool",level:3},{value:"cachetool_url",id:"cachetool_url",level:3},{value:"cachetool_args",id:"cachetool_args",level:3},{value:"bin/cachetool",id:"bincachetool",level:3},{value:"cachetool_options",id:"cachetool_options",level:3},{value:"Tasks",id:"tasks",level:2},{value:"cachetool:clear:opcache",id:"cachetoolclearopcache",level:3},{value:"cachetool:clear:apcu",id:"cachetoolclearapcu",level:3},{value:"cachetool:clear:stat",id:"cachetoolclearstat",level:3}],h={toc:i};function u(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,a.Z)({},h,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"cachetool-recipe"},"Cachetool Recipe"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"require 'contrib/cachetool.php';\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/tree/master/contrib/cachetool.php"},"Source")),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"cachetool")," ",(0,r.kt)("em",{parentName:"p"},"(optional)"),": accepts a ",(0,r.kt)("em",{parentName:"p"},"string")," or an ",(0,r.kt)("em",{parentName:"p"},"array")," of strings with the unix socket or ip address to php-fpm. If ",(0,r.kt)("inlineCode",{parentName:"p"},"cachetool")," is not given, then the application will look for a configuration file. The file must be named .cachetool.yml or .cachetool.yaml. CacheTool will look for this file on the current directory and in any parent directory until it finds one. If the paths above fail it will try to load /etc/cachetool.yml or /etc/cachetool.yaml configuration file."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"set('cachetool', '/var/run/php-fpm.sock');\n// or\nset('cachetool', '127.0.0.1:9000');\n// or\nset('cachetool', ['/var/run/php-fpm.sock', '/var/run/php-fpm-other.sock']);\n")))),(0,r.kt)("p",null,"You can also specify different cachetool settings for each host:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"host('staging')\n    ->set('cachetool', '127.0.0.1:9000');\n\nhost('production')\n    ->set('cachetool', '/var/run/php-fpm.sock');\n")),(0,r.kt)("p",null,"By default, if no ",(0,r.kt)("inlineCode",{parentName:"p"},"cachetool")," parameter is provided, this recipe will fallback to the global setting."),(0,r.kt)("p",null,"If your deployment user does not have permission to access the php-fpm.sock, you can alternatively use\nthe web adapter that creates a temporary php file and makes a web request to it with a configuration like"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"set('cachetool_args', '--web --web-path=./public --web-url=https://{{hostname}}');\n")),(0,r.kt)("h2",{id:"usage"},"Usage"),(0,r.kt)("p",null,"Since APCu and OPcache deal with compiling and caching files, they should be executed right after the symlink is created for the new release:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"after('deploy:symlink', 'cachetool:clear:opcache');\nor\nafter('deploy:symlink', 'cachetool:clear:apcu');\n")),(0,r.kt)("h2",{id:"read-more"},"Read more"),(0,r.kt)("p",null,"Read more information about cachetool on the website:\n",(0,r.kt)("a",{parentName:"p",href:"http://gordalina.github.io/cachetool/"},"http://gordalina.github.io/cachetool/")),(0,r.kt)("h2",{id:"configuration-1"},"Configuration"),(0,r.kt)("h3",{id:"cachetool"},"cachetool"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/cachetool.php#L50"},"Source")),(0,r.kt)("h3",{id:"cachetool_url"},"cachetool_url"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/cachetool.php#L58"},"Source")),(0,r.kt)("p",null,"URL to download cachetool from if it is not available"),(0,r.kt)("p",null,"CacheTool 9.x works with PHP >=8.1\nCacheTool 8.x works with PHP >=8.0\nCacheTool 7.x works with PHP >=7.3"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"'https://github.com/gordalina/cachetool/releases/download/9.0.0/cachetool.phar'\n")),(0,r.kt)("h3",{id:"cachetool_args"},"cachetool_args"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/cachetool.php#L59"},"Source")),(0,r.kt)("h3",{id:"bincachetool"},"bin/cachetool"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/cachetool.php#L60"},"Source")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"if (!test('[ -f {{release_or_current_path}}/cachetool.phar ]')) {\nrun(\"cd {{release_or_current_path}} && curl -sLO {{cachetool_url}}\");\n}\nreturn '{{release_or_current_path}}/cachetool.phar';\n")),(0,r.kt)("h3",{id:"cachetool_options"},"cachetool_options"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/cachetool.php#L66"},"Source")),(0,r.kt)("admonition",{title:"Autogenerated",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The value of this configuration is autogenerated on access.")),(0,r.kt)("h2",{id:"tasks"},"Tasks"),(0,r.kt)("h3",{id:"cachetoolclearopcache"},"cachetool:clear:opcache"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/cachetool.php#L88"},"Source")),(0,r.kt)("p",null,"Clears OPcode cache."),(0,r.kt)("p",null,"Clear opcache cache"),(0,r.kt)("h3",{id:"cachetoolclearapcu"},"cachetool:clear:apcu"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/cachetool.php#L99"},"Source")),(0,r.kt)("p",null,"Clears APCu system cache."),(0,r.kt)("p",null,"Clear APCu cache"),(0,r.kt)("h3",{id:"cachetoolclearstat"},"cachetool:clear:stat"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/cachetool.php#L110"},"Source")),(0,r.kt)("p",null,"Clears file status and realpath caches."),(0,r.kt)("p",null,"Clear file status cache, including the realpath cache"))}u.isMDXComponent=!0}}]);