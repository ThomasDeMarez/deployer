"use strict";(self.webpackChunkdeployer_docs=self.webpackChunkdeployer_docs||[]).push([[8092],{4137:(e,r,i)=>{i.d(r,{Zo:()=>c,kt:()=>d});var p=i(7294);function o(e,r,i){return r in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function t(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);r&&(p=p.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),i.push.apply(i,p)}return i}function n(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?t(Object(i),!0).forEach((function(r){o(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}function a(e,r){if(null==e)return{};var i,p,o=function(e,r){if(null==e)return{};var i,p,o={},t=Object.keys(e);for(p=0;p<t.length;p++)i=t[p],r.indexOf(i)>=0||(o[i]=e[i]);return o}(e,r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(p=0;p<t.length;p++)i=t[p],r.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(o[i]=e[i])}return o}var l=p.createContext({}),s=function(e){var r=p.useContext(l),i=r;return e&&(i="function"==typeof e?e(r):n(n({},r),e)),i},c=function(e){var r=s(e.components);return p.createElement(l.Provider,{value:r},e.children)},u={inlineCode:"code",wrapper:function(e){var r=e.children;return p.createElement(p.Fragment,{},r)}},v=p.forwardRef((function(e,r){var i=e.components,o=e.mdxType,t=e.originalType,l=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),v=s(i),d=o,h=v["".concat(l,".").concat(d)]||v[d]||u[d]||t;return i?p.createElement(h,n(n({ref:r},c),{},{components:i})):p.createElement(h,n({ref:r},c))}));function d(e,r){var i=arguments,o=r&&r.mdxType;if("string"==typeof e||o){var t=i.length,n=new Array(t);n[0]=v;var a={};for(var l in r)hasOwnProperty.call(r,l)&&(a[l]=r[l]);a.originalType=e,a.mdxType="string"==typeof e?e:o,n[1]=a;for(var s=2;s<t;s++)n[s]=i[s];return p.createElement.apply(null,n)}return p.createElement.apply(null,i)}v.displayName="MDXCreateElement"},5741:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>l,contentTitle:()=>n,default:()=>u,frontMatter:()=>t,metadata:()=>a,toc:()=>s});var p=i(7462),o=(i(7294),i(4137));const t={},n="Provision Recipe",a={unversionedId:"recipe/provision",id:"recipe/provision",title:"Provision Recipe",description:"Source",source:"@site/docs/recipe/provision.md",sourceDirName:"recipe",slug:"/recipe/provision",permalink:"/docs/7.x/recipe/provision",draft:!1,editUrl:"https://github.com/deployphp/deployer/edit/master/docs/recipe/provision.md",tags:[],version:"current",frontMatter:{}},l={},s=[{value:"Configuration",id:"configuration",level:2},{value:"lsb_release",id:"lsb_release",level:3},{value:"sudo_password",id:"sudo_password",level:3},{value:"ssh_copy_id",id:"ssh_copy_id",level:3},{value:"Tasks",id:"tasks",level:2},{value:"provision",id:"provision",level:3},{value:"provision:check",id:"provisioncheck",level:3},{value:"provision:configure",id:"provisionconfigure",level:3},{value:"provision:update",id:"provisionupdate",level:3},{value:"provision:upgrade",id:"provisionupgrade",level:3},{value:"provision:install",id:"provisioninstall",level:3},{value:"provision:server",id:"provisionserver",level:3},{value:"provision:ssh",id:"provisionssh",level:3},{value:"provision:deployer",id:"provisiondeployer",level:3},{value:"provision:firewall",id:"provisionfirewall",level:3},{value:"provision:verify",id:"provisionverify",level:3}],c={toc:s};function u(e){let{components:r,...i}=e;return(0,o.kt)("wrapper",(0,p.Z)({},c,i,{components:r,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"provision-recipe"},"Provision Recipe"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"require 'recipe/provision.php';\n")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/tree/master/recipe/provision.php"},"Source")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Requires",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision/databases"},"databases")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision/nodejs"},"nodejs")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision/php"},"php")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision/website"},"website"))))),(0,o.kt)("h2",{id:"configuration"},"Configuration"),(0,o.kt)("h3",{id:"lsb_release"},"lsb_release"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/provision.php#L15"},"Source")),(0,o.kt)("p",null,"Name of lsb_release like: focal, bionic, etc.\nAs only Ubuntu 20.04 LTS is supported for provision should be the ",(0,o.kt)("inlineCode",{parentName:"p"},"focal"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},'return run("lsb_release -s -c");\n')),(0,o.kt)("h3",{id:"sudo_password"},"sudo_password"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/provision.php#L216"},"Source")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"return askHiddenResponse(' Password for sudo: ');\n")),(0,o.kt)("h3",{id:"ssh_copy_id"},"ssh_copy_id"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/provision.php#L222"},"Source")),(0,o.kt)("p",null,"Specify which key to copy to server.\nSet to ",(0,o.kt)("inlineCode",{parentName:"p"},"false")," to disable copy of key."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"'~/.ssh/id_rsa.pub'\n")),(0,o.kt)("h2",{id:"tasks"},"Tasks"),(0,o.kt)("h3",{id:"provision"},"provision"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/provision.php#L20"},"Source")),(0,o.kt)("p",null,"Provision the server."),(0,o.kt)("p",null,"This task is group task which contains next tasks:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision#provisioncheck"},"provision:check")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision#provisionconfigure"},"provision:configure")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision#provisionupdate"},"provision:update")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision#provisionupgrade"},"provision:upgrade")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision#provisioninstall"},"provision:install")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision#provisionssh"},"provision:ssh")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision#provisionfirewall"},"provision:firewall")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision#provisiondeployer"},"provision:deployer")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision#provisionserver"},"provision:server")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision/php#provisionphp"},"provision:php")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision/databases#provisiondatabases"},"provision:databases")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision/php#provisioncomposer"},"provision:composer")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision/nodejs#provisionnpm"},"provision:npm")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision/website#provisionwebsite"},"provision:website")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/provision#provisionverify"},"provision:verify"))),(0,o.kt)("h3",{id:"provisioncheck"},"provision:check"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/provision.php#L39"},"Source")),(0,o.kt)("p",null,"Checks pre-required state."),(0,o.kt)("h3",{id:"provisionconfigure"},"provision:configure"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/provision.php#L59"},"Source")),(0,o.kt)("p",null,"Collects required params."),(0,o.kt)("h3",{id:"provisionupdate"},"provision:update"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/provision.php#L82"},"Source")),(0,o.kt)("p",null,"Adds repositories and update."),(0,o.kt)("h3",{id:"provisionupgrade"},"provision:upgrade"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/provision.php#L104"},"Source")),(0,o.kt)("p",null,"Upgrades all packages."),(0,o.kt)("h3",{id:"provisioninstall"},"provision:install"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/provision.php#L111"},"Source")),(0,o.kt)("p",null,"Installs packages."),(0,o.kt)("h3",{id:"provisionserver"},"provision:server"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/provision.php#L145"},"Source")),(0,o.kt)("p",null,"Configures a server."),(0,o.kt)("h3",{id:"provisionssh"},"provision:ssh"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/provision.php#L206"},"Source")),(0,o.kt)("p",null,"Configures the ssh."),(0,o.kt)("h3",{id:"provisiondeployer"},"provision:deployer"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/provision.php#L225"},"Source")),(0,o.kt)("p",null,"Setups a deployer user."),(0,o.kt)("h3",{id:"provisionfirewall"},"provision:firewall"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/provision.php#L272"},"Source")),(0,o.kt)("p",null,"Setups a firewall."),(0,o.kt)("h3",{id:"provisionverify"},"provision:verify"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/provision.php#L280"},"Source")),(0,o.kt)("p",null,"Verifies what provision was successful."))}u.isMDXComponent=!0}}]);