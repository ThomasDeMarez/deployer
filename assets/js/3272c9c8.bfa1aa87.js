"use strict";(self.webpackChunkdeployer_docs=self.webpackChunkdeployer_docs||[]).push([[2824],{4137:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>u});var l=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,l)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,l,n=function(e,t){if(null==e)return{};var a,l,n={},p=Object.keys(e);for(l=0;l<p.length;l++)a=p[l],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)a=p[l],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var i=l.createContext({}),s=function(e){var t=l.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},c=function(e){var t=s(e.components);return l.createElement(i.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},m=l.forwardRef((function(e,t){var a=e.components,n=e.mdxType,p=e.originalType,i=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=s(a),u=n,h=m["".concat(i,".").concat(u)]||m[u]||d[u]||p;return a?l.createElement(h,r(r({ref:t},c),{},{components:a})):l.createElement(h,r({ref:t},c))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var p=a.length,r=new Array(p);r[0]=m;var o={};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);o.originalType=e,o.mdxType="string"==typeof e?e:n,r[1]=o;for(var s=2;s<p;s++)r[s]=a[s];return l.createElement.apply(null,r)}return l.createElement.apply(null,a)}m.displayName="MDXCreateElement"},2909:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>r,default:()=>d,frontMatter:()=>p,metadata:()=>o,toc:()=>s});var l=a(7462),n=(a(7294),a(4137));const p={},r="How to Deploy a Magento 2 Project",o={unversionedId:"recipe/magento2",id:"recipe/magento2",title:"How to Deploy a Magento 2 Project",description:"Source",source:"@site/docs/recipe/magento2.md",sourceDirName:"recipe",slug:"/recipe/magento2",permalink:"/docs/7.x/recipe/magento2",draft:!1,editUrl:"https://github.com/deployphp/deployer/edit/master/docs/recipe/magento2.md",tags:[],version:"current",frontMatter:{}},i={},s=[{value:"Configuration",id:"configuration",level:2},{value:"static_content_locales",id:"static_content_locales",level:3},{value:"magento_themes",id:"magento_themes",level:3},{value:"static_deploy_options",id:"static_deploy_options",level:3},{value:"split_static_deployment",id:"split_static_deployment",level:3},{value:"static_content_locales_backend",id:"static_content_locales_backend",level:3},{value:"magento_themes_backend",id:"magento_themes_backend",level:3},{value:"static_content_jobs",id:"static_content_jobs",level:3},{value:"content_version",id:"content_version",level:3},{value:"magento_dir",id:"magento_dir",level:3},{value:"shared_files",id:"shared_files",level:3},{value:"shared_dirs",id:"shared_dirs",level:3},{value:"writable_dirs",id:"writable_dirs",level:3},{value:"clear_paths",id:"clear_paths",level:3},{value:"bin/magento",id:"binmagento",level:3},{value:"magento_version",id:"magento_version",level:3},{value:"config_import_needed",id:"config_import_needed",level:3},{value:"database_upgrade_needed",id:"database_upgrade_needed",level:3},{value:"enable_zerodowntime",id:"enable_zerodowntime",level:3},{value:"artifact_file",id:"artifact_file",level:3},{value:"artifact_dir",id:"artifact_dir",level:3},{value:"artifact_excludes_file",id:"artifact_excludes_file",level:3},{value:"build_from_repo",id:"build_from_repo",level:3},{value:"repository",id:"repository",level:3},{value:"artifact_path",id:"artifact_path",level:3},{value:"bin/tar",id:"bintar",level:3},{value:"additional_shared_files",id:"additional_shared_files",level:3},{value:"additional_shared_dirs",id:"additional_shared_dirs",level:3},{value:"Tasks",id:"tasks",level:2},{value:"magento:compile",id:"magentocompile",level:3},{value:"magento:deploy:assets",id:"magentodeployassets",level:3},{value:"magento:deploy:assets:adminhtml",id:"magentodeployassetsadminhtml",level:3},{value:"magento:deploy:assets:frontend",id:"magentodeployassetsfrontend",level:3},{value:"magento:sync:content_version",id:"magentosynccontent_version",level:3},{value:"magento:maintenance:enable",id:"magentomaintenanceenable",level:3},{value:"magento:maintenance:disable",id:"magentomaintenancedisable",level:3},{value:"magento:maintenance:enable-if-needed",id:"magentomaintenanceenable-if-needed",level:3},{value:"magento:config:import",id:"magentoconfigimport",level:3},{value:"magento:upgrade:db",id:"magentoupgradedb",level:3},{value:"magento:cache:flush",id:"magentocacheflush",level:3},{value:"deploy:magento",id:"deploymagento",level:3},{value:"magento:build",id:"magentobuild",level:3},{value:"deploy",id:"deploy",level:3},{value:"artifact:package",id:"artifactpackage",level:3},{value:"artifact:upload",id:"artifactupload",level:3},{value:"artifact:extract",id:"artifactextract",level:3},{value:"build:remove-generated",id:"buildremove-generated",level:3},{value:"build:prepare",id:"buildprepare",level:3},{value:"artifact:build",id:"artifactbuild",level:3},{value:"deploy:additional-shared",id:"deployadditional-shared",level:3},{value:"magento:set_cache_prefix",id:"magentoset_cache_prefix",level:3},{value:"magento:cleanup_cache_prefix",id:"magentocleanup_cache_prefix",level:3},{value:"magento:cron:stop",id:"magentocronstop",level:3},{value:"magento:cron:install",id:"magentocroninstall",level:3},{value:"artifact:prepare",id:"artifactprepare",level:3},{value:"artifact:finish",id:"artifactfinish",level:3},{value:"artifact:deploy",id:"artifactdeploy",level:3}],c={toc:s};function d(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,l.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"how-to-deploy-a-magento-2-project"},"How to Deploy a Magento 2 Project"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php"},"require 'recipe/magento2.php';\n")),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/tree/master/recipe/magento2.php"},"Source")),(0,n.kt)("p",null,"Deployer is a free and open source deployment tool written in PHP.\nIt helps you to deploy your Magento 2 application to a server.\nIt is very easy to use and has a lot of features. "),(0,n.kt)("p",null,"Three main features of Deployer are:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Provisioning")," - provision your server for you."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Zero downtime deployment")," - deploy your application without a downtime."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Rollbacks")," - rollback your application to a previous version, if something goes wrong.")),(0,n.kt)("p",null,"Additionally, Deployer has a lot of other features, like:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Easy to use")," - Deployer is very easy to use. It has a simple and intuitive syntax."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Fast")," - Deployer is very fast. It uses parallel connections to deploy your application."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Secure")," - Deployer uses SSH to connect to your server."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Supports all major PHP frameworks")," - Deployer supports all major PHP frameworks.")),(0,n.kt)("p",null,"You can read more about Deployer in ",(0,n.kt)("a",{parentName:"p",href:"/docs/7.x/getting-started"},"Getting Started"),"."),(0,n.kt)("p",null,"The ",(0,n.kt)("a",{parentName:"p",href:"#deploy"},"deploy")," task of ",(0,n.kt)("strong",{parentName:"p"},"Magento 2")," consists of:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/common#deployprepare"},"deploy:prepare")," \u2013 Prepares a new release",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/info#deployinfo"},"deploy:info")," \u2013 Displays info about deployment"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/setup#deploysetup"},"deploy:setup")," \u2013 Prepares host for deploy"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/lock#deploylock"},"deploy:lock")," \u2013 Locks deploy"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/release#deployrelease"},"deploy:release")," \u2013 Prepares release"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/update_code#deployupdate_code"},"deploy:update_code")," \u2013 Updates code"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/shared#deployshared"},"deploy:shared")," \u2013 Creates symlinks for shared files and dirs"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/writable#deploywritable"},"deploy:writable")," \u2013 Makes writable dirs"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/vendors#deployvendors"},"deploy:vendors")," \u2013 Installs vendors"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/clear_paths#deployclear_paths"},"deploy:clear_paths")," \u2013 Cleanup files and/or directories"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#deploymagento"},"deploy:magento")," \u2013 Magento2 deployment operations",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentobuild"},"magento:build")," \u2013 Magento2 build operations",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentocompile"},"magento:compile")," \u2013 Compiles magento di"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentodeployassets"},"magento:deploy:assets")," \u2013 Deploys assets"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentomaintenanceenable-if-needed"},"magento:maintenance:enable-if-needed")," \u2013 Set maintenance mode if needed"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentoconfigimport"},"magento:config:import")," \u2013 Config Import"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentoupgradedb"},"magento:upgrade:db")," \u2013 Upgrades magento database"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentomaintenancedisable"},"magento:maintenance:disable")," \u2013 Disables maintenance mode"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentocacheflush"},"magento:cache:flush")," \u2013 Flushes Magento Cache"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/common#deploypublish"},"deploy:publish")," \u2013 Publishes the release",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/symlink#deploysymlink"},"deploy:symlink")," \u2013 Creates symlink to release"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/lock#deployunlock"},"deploy:unlock")," \u2013 Unlocks deploy"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/cleanup#deploycleanup"},"deploy:cleanup")," \u2013 Cleanup old releases"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/common#deploysuccess"},"deploy:success")," \u2013 ")))),(0,n.kt)("p",null,"In addition the ",(0,n.kt)("strong",{parentName:"p"},"Magento 2")," recipe contains an artifact deployment.\nThis is a two step process where you first execute"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php"},"bin/dep artifact:build [options] [localhost]\n")),(0,n.kt)("p",null,"to build an artifact, which then is deployed on a server with"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php"},"bin/dep artifact:deploy [host]\n")),(0,n.kt)("p",null,"The ",(0,n.kt)("inlineCode",{parentName:"p"},"localhost")," to build the artifact on has to be declared local, so either add"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php"},"localhost()\n    ->set('local', true);\n")),(0,n.kt)("p",null,"to your deploy.php or"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},"hosts:\n    localhost:\n        local: true\n")),(0,n.kt)("p",null,"to your deploy yaml."),(0,n.kt)("p",null,"The ",(0,n.kt)("a",{parentName:"p",href:"#artifact:build"},"artifact:build")," command of ",(0,n.kt)("strong",{parentName:"p"},"Magento 2")," consists of: * ",(0,n.kt)("a",{parentName:"p",href:"/docs/7.x/recipe/magento2#buildprepare"},"build:prepare")," \u2013 Prepare local artifact build"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#buildremove-generated"},"build:remove-generated")," \u2013 Clears generated files prior to building."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/vendors#deployvendors"},"deploy:vendors")," \u2013 Installs vendors"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentocompile"},"magento:compile")," \u2013 Compiles magento di"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentodeployassets"},"magento:deploy:assets")," \u2013 Deploys assets"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#artifactpackage"},"artifact:package")," \u2013 Packages all relevant files in an artifact.")),(0,n.kt)("p",null," The ",(0,n.kt)("a",{parentName:"p",href:"#artifact:deploy"},"artifact:deploy")," command of ",(0,n.kt)("strong",{parentName:"p"},"Magento 2")," consists of:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#artifactprepare"},"artifact:prepare")," \u2013 Prepares an artifact on the target server",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/info#deployinfo"},"deploy:info")," \u2013 Displays info about deployment"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/setup#deploysetup"},"deploy:setup")," \u2013 Prepares host for deploy"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/lock#deploylock"},"deploy:lock")," \u2013 Locks deploy"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/release#deployrelease"},"deploy:release")," \u2013 Prepares release"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#artifactupload"},"artifact:upload")," \u2013 Uploads artifact in release folder for extraction."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#artifactextract"},"artifact:extract")," \u2013 Extracts artifact in release path."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#deployadditional-shared"},"deploy:additional-shared")," \u2013 Adds additional files and dirs to the list of shared files and dirs"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/shared#deployshared"},"deploy:shared")," \u2013 Creates symlinks for shared files and dirs"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/writable#deploywritable"},"deploy:writable")," \u2013 Makes writable dirs"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentomaintenanceenable-if-needed"},"magento:maintenance:enable-if-needed")," \u2013 Set maintenance mode if needed"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentoconfigimport"},"magento:config:import")," \u2013 Config Import"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentoupgradedb"},"magento:upgrade:db")," \u2013 Upgrades magento database"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentomaintenancedisable"},"magento:maintenance:disable")," \u2013 Disables maintenance mode"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/symlink#deploysymlink"},"deploy:symlink")," \u2013 Creates symlink to release"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#artifactfinish"},"artifact:finish")," \u2013 Executes the tasks after artifact is released",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentocacheflush"},"magento:cache:flush")," \u2013 Flushes Magento Cache"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/contrib/cachetool#cachetoolclearopcache"},"cachetool:clear:opcache")," \u2013 Clears OPcode cache"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/cleanup#deploycleanup"},"deploy:cleanup")," \u2013 Cleanup old releases"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/lock#deployunlock"},"deploy:unlock")," \u2013 Unlocks deploy")))),(0,n.kt)("p",null,"The magento2 recipe is based on the ",(0,n.kt)("a",{parentName:"p",href:"/docs/7.x/recipe/common"},"common")," recipe."),(0,n.kt)("h2",{id:"configuration"},"Configuration"),(0,n.kt)("h3",{id:"static_content_locales"},"static_content_locales"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L26"},"Source")),(0,n.kt)("p",null,"By default setup:static-content:deploy uses ",(0,n.kt)("inlineCode",{parentName:"p"},"en_US"),".\nTo change that, simply put ",(0,n.kt)("inlineCode",{parentName:"p"},"set('static_content_locales', 'en_US de_DE');"),"\nin you deployer script."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"'en_US'\n")),(0,n.kt)("h3",{id:"magento_themes"},"magento_themes"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L43"},"Source")),(0,n.kt)("p",null,"You can also set the themes to run against. By default it'll deploy\nall themes - ",(0,n.kt)("inlineCode",{parentName:"p"},"add('magento_themes', ['Magento/luma', 'Magento/backend']);"),"\nIf the themes are set as a simple list of strings, then all languages defined in ",(0,n.kt)("a",{parentName:"p",href:"/docs/7.x/recipe/magento2#static_content_locales"},"static_content_locales")," are\ncompiled for the given themes.\nAlternatively The themes can be defined as an associative array, where the key represents the theme name and\nthe key contains the languages for the compilation (for this specific theme)\nExample:\nset('magento_themes', ","['Magento/luma']","); - Will compile this theme with every language from ",(0,n.kt)("a",{parentName:"p",href:"/docs/7.x/recipe/magento2#static_content_locales"},"static_content_locales"),"\nset('magento_themes', [\n'Magento/luma'   => null,                              - Will compile all languages from ",(0,n.kt)("a",{parentName:"p",href:"/docs/7.x/recipe/magento2#static_content_locales"},"static_content_locales")," for Magento/luma\n'Custom/theme'   => 'en_US fr_FR'                      - Will compile only en_US and fr_FR for Custom/theme\n'Custom/another' => '",(0,n.kt)("a",{parentName:"p",href:"/docs/7.x/recipe/magento2#static_content_locales"},"static_content_locales")," it_IT' - Will compile all languages from ",(0,n.kt)("a",{parentName:"p",href:"/docs/7.x/recipe/magento2#static_content_locales"},"static_content_locales")," + it_IT for Custom/another\n]); - Will compile this theme with every language"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"[\n\n]\n")),(0,n.kt)("h3",{id:"static_deploy_options"},"static_deploy_options"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L48"},"Source")),(0,n.kt)("p",null,"Static content deployment options, e.g. '--no-parent'"),(0,n.kt)("h3",{id:"split_static_deployment"},"split_static_deployment"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L51"},"Source")),(0,n.kt)("p",null,"Deploy frontend and adminhtml together as default"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"false\n")),(0,n.kt)("h3",{id:"static_content_locales_backend"},"static_content_locales_backend"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L54"},"Source")),(0,n.kt)("p",null,"Use the default languages for the backend as default"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"'{{static_content_locales}}'\n")),(0,n.kt)("h3",{id:"magento_themes_backend"},"magento_themes_backend"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L58"},"Source")),(0,n.kt)("p",null,"backend themes to deploy. Only used if split_static_deployment=true\nThis setting supports the same options/structure as ",(0,n.kt)("a",{parentName:"p",href:"/docs/7.x/recipe/magento2#magento_themes"},"magento_themes")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"['Magento/backend' => null]\n")),(0,n.kt)("h3",{id:"static_content_jobs"},"static_content_jobs"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L64"},"Source")),(0,n.kt)("p",null,"Also set the number of conccurent jobs to run. The default is 1\nUpdate using: ",(0,n.kt)("inlineCode",{parentName:"p"},"set('static_content_jobs', '1');")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"'1'\n")),(0,n.kt)("h3",{id:"content_version"},"content_version"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L66"},"Source")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"return time();\n")),(0,n.kt)("h3",{id:"magento_dir"},"magento_dir"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L71"},"Source")),(0,n.kt)("p",null,'Magento directory relative to repository root. Use "." (default) if it is not located in a subdirectory'),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"'.'\n")),(0,n.kt)("h3",{id:"shared_files"},"shared_files"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L74"},"Source")),(0,n.kt)("p",null,"Overrides ",(0,n.kt)("a",{parentName:"p",href:"/docs/7.x/recipe/deploy/shared#shared_files"},"shared_files")," from ",(0,n.kt)("inlineCode",{parentName:"p"},"recipe/deploy/shared.php"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"[\n    '{{magento_dir}}/app/etc/env.php',\n    '{{magento_dir}}/var/.maintenance.ip',\n]\n")),(0,n.kt)("h3",{id:"shared_dirs"},"shared_dirs"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L78"},"Source")),(0,n.kt)("p",null,"Overrides ",(0,n.kt)("a",{parentName:"p",href:"/docs/7.x/recipe/deploy/shared#shared_dirs"},"shared_dirs")," from ",(0,n.kt)("inlineCode",{parentName:"p"},"recipe/deploy/shared.php"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"[\n    '{{magento_dir}}/var/composer_home',\n    '{{magento_dir}}/var/log',\n    '{{magento_dir}}/var/export',\n    '{{magento_dir}}/var/report',\n    '{{magento_dir}}/var/import',\n    '{{magento_dir}}/var/import_history',\n    '{{magento_dir}}/var/session',\n    '{{magento_dir}}/var/importexport',\n    '{{magento_dir}}/var/backups',\n    '{{magento_dir}}/var/tmp',\n    '{{magento_dir}}/pub/sitemap',\n    '{{magento_dir}}/pub/media',\n    '{{magento_dir}}/pub/static/_cache'\n]\n")),(0,n.kt)("h3",{id:"writable_dirs"},"writable_dirs"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L93"},"Source")),(0,n.kt)("p",null,"Overrides ",(0,n.kt)("a",{parentName:"p",href:"/docs/7.x/recipe/deploy/writable#writable_dirs"},"writable_dirs")," from ",(0,n.kt)("inlineCode",{parentName:"p"},"recipe/deploy/writable.php"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"[\n    '{{magento_dir}}/var',\n    '{{magento_dir}}/pub/static',\n    '{{magento_dir}}/pub/media',\n    '{{magento_dir}}/generated',\n    '{{magento_dir}}/var/page_cache'\n]\n")),(0,n.kt)("h3",{id:"clear_paths"},"clear_paths"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L100"},"Source")),(0,n.kt)("p",null,"Overrides ",(0,n.kt)("a",{parentName:"p",href:"/docs/7.x/recipe/deploy/clear_paths#clear_paths"},"clear_paths")," from ",(0,n.kt)("inlineCode",{parentName:"p"},"recipe/deploy/clear_paths.php"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"[\n    '{{magento_dir}}/generated/*',\n    '{{magento_dir}}/pub/static/_cache/*',\n    '{{magento_dir}}/var/generation/*',\n    '{{magento_dir}}/var/cache/*',\n    '{{magento_dir}}/var/page_cache/*',\n    '{{magento_dir}}/var/view_preprocessed/*'\n]\n")),(0,n.kt)("h3",{id:"binmagento"},"bin/magento"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L109"},"Source")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"'{{release_or_current_path}}/{{magento_dir}}/bin/magento'\n")),(0,n.kt)("h3",{id:"magento_version"},"magento_version"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L111"},"Source")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"// detect version\n$versionOutput = run('{{bin/php}} {{bin/magento}} --version');\npreg_match('/(\\d+\\.?)+(-p\\d+)?$/', $versionOutput, $matches);\nreturn $matches[0] ?? '2.0';\n")),(0,n.kt)("h3",{id:"config_import_needed"},"config_import_needed"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L118"},"Source")),(0,n.kt)("admonition",{title:"Autogenerated",type:"info"},(0,n.kt)("p",{parentName:"admonition"},"The value of this configuration is autogenerated on access.")),(0,n.kt)("h3",{id:"database_upgrade_needed"},"database_upgrade_needed"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L132"},"Source")),(0,n.kt)("admonition",{title:"Autogenerated",type:"info"},(0,n.kt)("p",{parentName:"admonition"},"The value of this configuration is autogenerated on access.")),(0,n.kt)("h3",{id:"enable_zerodowntime"},"enable_zerodowntime"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L157"},"Source")),(0,n.kt)("p",null,"Deploy without setting maintenance mode if possible"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"true\n")),(0,n.kt)("h3",{id:"artifact_file"},"artifact_file"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L343"},"Source")),(0,n.kt)("p",null,"The file the artifact is saved to"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"'artifact.tar.gz'\n")),(0,n.kt)("h3",{id:"artifact_dir"},"artifact_dir"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L346"},"Source")),(0,n.kt)("p",null,"The directory the artifact is saved in"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"'artifacts'\n")),(0,n.kt)("h3",{id:"artifact_excludes_file"},"artifact_excludes_file"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L350"},"Source")),(0,n.kt)("p",null,"Points to a file with a list of files to exclude from packaging.\nThe format is as with the ",(0,n.kt)("inlineCode",{parentName:"p"},"tar --exclude-from=[file]")," option"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"'artifacts/excludes'\n")),(0,n.kt)("h3",{id:"build_from_repo"},"build_from_repo"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L353"},"Source")),(0,n.kt)("p",null,"If set to true, the artifact is built from a clean copy of the project repository instead of the current working directory"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"false\n")),(0,n.kt)("h3",{id:"repository"},"repository"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L356"},"Source")),(0,n.kt)("p",null,"Overrides ",(0,n.kt)("a",{parentName:"p",href:"/docs/7.x/recipe/common#repository"},"repository")," from ",(0,n.kt)("inlineCode",{parentName:"p"},"recipe/common.php"),"."),(0,n.kt)("p",null,'Set this value if "build_from_repo" is set to true. The target to deploy must also be set with "--branch", "--tag" or "--revision"'),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"null\n")),(0,n.kt)("h3",{id:"artifact_path"},"artifact_path"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L359"},"Source")),(0,n.kt)("p",null,"The relative path to the artifact file. If the directory does not exist, it will be created"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"if (!testLocally('[ -d {{artifact_dir}} ]')) {\nrunLocally('mkdir -p {{artifact_dir}}');\n}\nreturn get('artifact_dir') . '/' . get('artifact_file');\n")),(0,n.kt)("h3",{id:"bintar"},"bin/tar"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L367"},"Source")),(0,n.kt)("p",null,"The location of the tar command. On MacOS you should have installed gtar, as it supports the required settings"),(0,n.kt)("admonition",{title:"Autogenerated",type:"info"},(0,n.kt)("p",{parentName:"admonition"},"The value of this configuration is autogenerated on access.")),(0,n.kt)("h3",{id:"additional_shared_files"},"additional_shared_files"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L439"},"Source")),(0,n.kt)("p",null,"Array of shared files that will be added to the default shared_files without overriding"),(0,n.kt)("h3",{id:"additional_shared_dirs"},"additional_shared_dirs"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L441"},"Source")),(0,n.kt)("p",null,"Array of shared directories that will be added to the default shared_dirs without overriding"),(0,n.kt)("h2",{id:"tasks"},"Tasks"),(0,n.kt)("h3",{id:"magentocompile"},"magento:compile"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L167"},"Source")),(0,n.kt)("p",null,"Compiles magento di."),(0,n.kt)("p",null,"To work correctly with artifact deployment, it is necessary to set the MAGE_MODE correctly in ",(0,n.kt)("inlineCode",{parentName:"p"},"app/etc/config.php"),"\ne.g."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php"},"'MAGE_MODE' => 'production'\n")),(0,n.kt)("h3",{id:"magentodeployassets"},"magento:deploy:assets"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L193"},"Source")),(0,n.kt)("p",null,"Deploys assets."),(0,n.kt)("p",null,"To work correctly with artifact deployment it is necessary to set ",(0,n.kt)("inlineCode",{parentName:"p"},"system/dev/js")," , ",(0,n.kt)("inlineCode",{parentName:"p"},"system/dev/css")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"system/dev/template"),"\nin ",(0,n.kt)("inlineCode",{parentName:"p"},"app/etc/config.php"),", e.g.:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php"},"'system' => [\n    'default' => [\n        'dev' => [\n            'js' => [\n                'merge_files' => '1',\n                'minify_files' => '1'\n            ],\n            'css' => [\n                'merge_files' => '1',\n                'minify_files' => '1'\n            ],\n            'template' => [\n                'minify_html' => '1'\n            ]\n        ]\n    ]\n")),(0,n.kt)("h3",{id:"magentodeployassetsadminhtml"},"magento:deploy:assets:adminhtml"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L209"},"Source")),(0,n.kt)("p",null,"Deploys assets for backend only."),(0,n.kt)("h3",{id:"magentodeployassetsfrontend"},"magento:deploy:assets:frontend"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L214"},"Source")),(0,n.kt)("p",null,"Deploys assets for frontend only."),(0,n.kt)("h3",{id:"magentosynccontent_version"},"magento:sync:content_version"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L262"},"Source")),(0,n.kt)("p",null,"Syncs content version."),(0,n.kt)("h3",{id:"magentomaintenanceenable"},"magento:maintenance:enable"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L272"},"Source")),(0,n.kt)("p",null,"Enables maintenance mode."),(0,n.kt)("h3",{id:"magentomaintenancedisable"},"magento:maintenance:disable"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L278"},"Source")),(0,n.kt)("p",null,"Disables maintenance mode."),(0,n.kt)("h3",{id:"magentomaintenanceenable-if-needed"},"magento:maintenance:enable-if-needed"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L284"},"Source")),(0,n.kt)("p",null,"Set maintenance mode if needed."),(0,n.kt)("h3",{id:"magentoconfigimport"},"magento:config:import"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L291"},"Source")),(0,n.kt)("p",null,"Config Import."),(0,n.kt)("h3",{id:"magentoupgradedb"},"magento:upgrade:db"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L300"},"Source")),(0,n.kt)("p",null,"Upgrades magento database."),(0,n.kt)("h3",{id:"magentocacheflush"},"magento:cache:flush"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L309"},"Source")),(0,n.kt)("p",null,"Flushes Magento Cache."),(0,n.kt)("h3",{id:"deploymagento"},"deploy:magento"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L314"},"Source")),(0,n.kt)("p",null,"Magento2 deployment operations."),(0,n.kt)("p",null,"This task is group task which contains next tasks:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentobuild"},"magento:build")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentomaintenanceenable-if-needed"},"magento:maintenance:enable-if-needed")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentoconfigimport"},"magento:config:import")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentoupgradedb"},"magento:upgrade:db")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentomaintenancedisable"},"magento:maintenance:disable")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentocacheflush"},"magento:cache:flush"))),(0,n.kt)("h3",{id:"magentobuild"},"magento:build"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L324"},"Source")),(0,n.kt)("p",null,"Magento2 build operations."),(0,n.kt)("p",null,"This task is group task which contains next tasks:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentocompile"},"magento:compile")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentodeployassets"},"magento:deploy:assets"))),(0,n.kt)("h3",{id:"deploy"},"deploy"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L330"},"Source")),(0,n.kt)("p",null,"Deploys your project."),(0,n.kt)("p",null,"This task is group task which contains next tasks:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/common#deployprepare"},"deploy:prepare")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/vendors#deployvendors"},"deploy:vendors")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/clear_paths#deployclear_paths"},"deploy:clear_paths")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#deploymagento"},"deploy:magento")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/common#deploypublish"},"deploy:publish"))),(0,n.kt)("h3",{id:"artifactpackage"},"artifact:package"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L378"},"Source")),(0,n.kt)("p",null,"Packages all relevant files in an artifact."),(0,n.kt)("h3",{id:"artifactupload"},"artifact:upload"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L388"},"Source")),(0,n.kt)("p",null,"Uploads artifact in release folder for extraction."),(0,n.kt)("h3",{id:"artifactextract"},"artifact:extract"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L393"},"Source")),(0,n.kt)("p",null,"Extracts artifact in release path."),(0,n.kt)("h3",{id:"buildremove-generated"},"build:remove-generated"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L399"},"Source")),(0,n.kt)("p",null,"Clears generated files prior to building."),(0,n.kt)("h3",{id:"buildprepare"},"build:prepare"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L404"},"Source")),(0,n.kt)("p",null,"Prepare local artifact build."),(0,n.kt)("h3",{id:"artifactbuild"},"artifact:build"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L429"},"Source")),(0,n.kt)("p",null,"Builds an artifact."),(0,n.kt)("p",null,"This task is group task which contains next tasks:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#buildprepare"},"build:prepare")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#buildremove-generated"},"build:remove-generated")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/vendors#deployvendors"},"deploy:vendors")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentocompile"},"magento:compile")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentodeployassets"},"magento:deploy:assets")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#artifactpackage"},"artifact:package"))),(0,n.kt)("h3",{id:"deployadditional-shared"},"deploy:additional-shared"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L445"},"Source")),(0,n.kt)("p",null,"Adds additional files and dirs to the list of shared files and dirs."),(0,n.kt)("h3",{id:"magentoset_cache_prefix"},"magento:set_cache_prefix"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L460"},"Source")),(0,n.kt)("p",null,"Update cache id_prefix."),(0,n.kt)("p",null,"Update cache id_prefix on deploy so that you are compiling against a fresh cache\nReference Issue: ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/davidalger/capistrano-magento2/issues/151"},"https://github.com/davidalger/capistrano-magento2/issues/151"),"\nTo use this feature, add the following to your deployer scripts:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php"},"after('deploy:shared', 'magento:set_cache_prefix');\nafter('deploy:magento', 'magento:cleanup_cache_prefix');\n")),(0,n.kt)("h3",{id:"magentocleanup_cache_prefix"},"magento:cleanup_cache_prefix"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L500"},"Source")),(0,n.kt)("p",null,"Cleanup cache id_prefix env files."),(0,n.kt)("p",null,"After successful deployment, move the tmp_env.php file to env.php ready for next deployment"),(0,n.kt)("h3",{id:"magentocronstop"},"magento:cron:stop"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L516"},"Source")),(0,n.kt)("p",null,"Remove cron from crontab and kill running cron jobs."),(0,n.kt)("p",null,"Remove cron from crontab and kill running cron jobs\nTo use this feature, add the following to your deployer scripts:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php"},"after('magento:maintenance:enable-if-needed', 'magento:cron:stop');\n")),(0,n.kt)("h3",{id:"magentocroninstall"},"magento:cron:install"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L532"},"Source")),(0,n.kt)("p",null,"Install cron in crontab."),(0,n.kt)("p",null,"Install cron in crontab\nTo use this feature, add the following to your deployer scripts:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php"},"after('magento:upgrade:db', 'magento:cron:install');\n")),(0,n.kt)("h3",{id:"artifactprepare"},"artifact:prepare"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L538"},"Source")),(0,n.kt)("p",null,"Prepares an artifact on the target server."),(0,n.kt)("p",null,"This task is group task which contains next tasks:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/info#deployinfo"},"deploy:info")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/setup#deploysetup"},"deploy:setup")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/lock#deploylock"},"deploy:lock")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/release#deployrelease"},"deploy:release")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#artifactupload"},"artifact:upload")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#artifactextract"},"artifact:extract")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#deployadditional-shared"},"deploy:additional-shared")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/shared#deployshared"},"deploy:shared")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/writable#deploywritable"},"deploy:writable"))),(0,n.kt)("h3",{id:"artifactfinish"},"artifact:finish"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L551"},"Source")),(0,n.kt)("p",null,"Executes the tasks after artifact is released."),(0,n.kt)("p",null,"This task is group task which contains next tasks:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentocacheflush"},"magento:cache:flush")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/contrib/cachetool#cachetoolclearopcache"},"cachetool:clear:opcache")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/cleanup#deploycleanup"},"deploy:cleanup")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/lock#deployunlock"},"deploy:unlock"))),(0,n.kt)("h3",{id:"artifactdeploy"},"artifact:deploy"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/recipe/magento2.php#L560"},"Source")),(0,n.kt)("p",null,"Actually releases the artifact deployment."),(0,n.kt)("p",null,"This task is group task which contains next tasks:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#artifactprepare"},"artifact:prepare")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentomaintenanceenable-if-needed"},"magento:maintenance:enable-if-needed")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentoconfigimport"},"magento:config:import")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentoupgradedb"},"magento:upgrade:db")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#magentomaintenancedisable"},"magento:maintenance:disable")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/deploy/symlink#deploysymlink"},"deploy:symlink")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/7.x/recipe/magento2#artifactfinish"},"artifact:finish"))))}d.isMDXComponent=!0}}]);