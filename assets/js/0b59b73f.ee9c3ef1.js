"use strict";(self.webpackChunkdeployer_docs=self.webpackChunkdeployer_docs||[]).push([[3101],{4137:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},l=Object.keys(e);for(o=0;o<l.length;o++)n=l[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=o.createContext({}),p=function(e){var t=o.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=p(e.components);return o.createElement(i.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),m=a,h=u["".concat(i,".").concat(m)]||u[m]||d[m]||l;return n?o.createElement(h,r(r({ref:t},c),{},{components:n})):o.createElement(h,r({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,r=new Array(l);r[0]=u;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var p=2;p<l;p++)r[p]=n[p];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},5478:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>r,default:()=>d,frontMatter:()=>l,metadata:()=>s,toc:()=>p});var o=n(7462),a=(n(7294),n(4137));const l={},r="Hosts",s={unversionedId:"hosts",id:"hosts",title:"Hosts",description:"To define a new host use the host() function. Deployer keeps a list of",source:"@site/docs/hosts.md",sourceDirName:".",slug:"/hosts",permalink:"/docs/7.x/hosts",draft:!1,editUrl:"https://github.com/deployphp/deployer/edit/master/docs/hosts.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Basics",permalink:"/docs/7.x/basics"},next:{title:"Tasks",permalink:"/docs/7.x/tasks"}},i={},p=[{value:"Host config",id:"host-config",level:2},{value:"<code>alias</code>",id:"alias",level:3},{value:"<code>hostname</code>",id:"hostname",level:3},{value:"<code>remote_user</code>",id:"remote_user",level:3},{value:"<code>port</code>",id:"port",level:3},{value:"<code>config_file</code>",id:"config_file",level:3},{value:"<code>identity_file</code>",id:"identity_file",level:3},{value:"<code>forward_agent</code>",id:"forward_agent",level:3},{value:"<code>ssh_multiplexing</code>",id:"ssh_multiplexing",level:3},{value:"<code>shell</code>",id:"shell",level:3},{value:"<code>deploy_path</code>",id:"deploy_path",level:3},{value:"<code>labels</code>",id:"labels",level:3},{value:"<code>ssh_arguments</code>",id:"ssh_arguments",level:3},{value:"<code>ssh_control_path</code>",id:"ssh_control_path",level:3},{value:"Multiple hosts",id:"multiple-hosts",level:2},{value:"Host ranges",id:"host-ranges",level:2},{value:"Localhost",id:"localhost",level:2},{value:"YAML Inventory",id:"yaml-inventory",level:2}],c={toc:p};function d(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"hosts"},"Hosts"),(0,a.kt)("p",null,"To define a new host use the ",(0,a.kt)("a",{parentName:"p",href:"/docs/7.x/api#host"},"host()")," function. Deployer keeps a list of\nall defined hosts in the ",(0,a.kt)("inlineCode",{parentName:"p"},"Deployer::get()->hosts")," collection."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"host('example.org');\n")),(0,a.kt)("p",null,"Each host contains it's own configuration key-value pairs. The ",(0,a.kt)("a",{parentName:"p",href:"/docs/7.x/api#host"},"host()"),"\ncall defines two important configs: ",(0,a.kt)("strong",{parentName:"p"},"alias")," and ",(0,a.kt)("strong",{parentName:"p"},"hostname"),"."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"hostname")," - used when connecting to remote host."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"alias")," - used as a key in ",(0,a.kt)("inlineCode",{parentName:"li"},"Deployer::get()->hosts")," collection.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"task('test', function () {\n    writeln('The {{alias}} is {{hostname}}');\n});\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ dep test\n[example.org] The example.org is example.org\n")),(0,a.kt)("p",null,"We can override hostname via ",(0,a.kt)("inlineCode",{parentName:"p"},"set()")," method:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"host('example.org')\n    ->set('hostname', 'example.cloud.google.com');\n")),(0,a.kt)("p",null,"The hostname will be used for the ssh connection, but the host will be referred\nby its alias when running Deployer."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ dep test\n[example.org] The example.org is example.cloud.google.com\n")),(0,a.kt)("p",null,"Another important ssh connection parameter is ",(0,a.kt)("inlineCode",{parentName:"p"},"remote_user"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"host('example.org')\n    ->set('hostname', 'example.cloud.google.com')\n    ->set('remote_user', 'deployer');\n")),(0,a.kt)("p",null,"Now Deployer will connect using something like\n",(0,a.kt)("inlineCode",{parentName:"p"},"ssh deployer@example.cloud.google.com")," to establishing connection."),(0,a.kt)("p",null,"Also, Deployer's ",(0,a.kt)("inlineCode",{parentName:"p"},"Host")," class has special setter methods (for better IDE\nautocompletion)."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"host('example.org')\n    ->setHostname('example.cloud.google.com')\n    ->setRemoteUser('deployer');\n")),(0,a.kt)("h2",{id:"host-config"},"Host config"),(0,a.kt)("h3",{id:"alias"},(0,a.kt)("inlineCode",{parentName:"h3"},"alias")),(0,a.kt)("p",null,"The identifier used to identify a host.\nYou can use actual hostname or something like ",(0,a.kt)("inlineCode",{parentName:"p"},"prod")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"staging"),"."),(0,a.kt)("h3",{id:"hostname"},(0,a.kt)("inlineCode",{parentName:"h3"},"hostname")),(0,a.kt)("p",null,"Deployer uses this config for actual ssh connection."),(0,a.kt)("h3",{id:"remote_user"},(0,a.kt)("inlineCode",{parentName:"h3"},"remote_user")),(0,a.kt)("p",null,"Deployer uses this config for actual ssh connection. If not specified,\nDeployer will be using ",(0,a.kt)("inlineCode",{parentName:"p"},"RemoteUser")," from ",(0,a.kt)("strong",{parentName:"p"},"~/.ssh/config")," file, or current\nOS username."),(0,a.kt)("h3",{id:"port"},(0,a.kt)("inlineCode",{parentName:"h3"},"port")),(0,a.kt)("p",null,"Port of remote ssh server to connect to. Default is ",(0,a.kt)("inlineCode",{parentName:"p"},"22"),"."),(0,a.kt)("h3",{id:"config_file"},(0,a.kt)("inlineCode",{parentName:"h3"},"config_file")),(0,a.kt)("p",null,"Default is ",(0,a.kt)("inlineCode",{parentName:"p"},"~/.ssh/config"),"."),(0,a.kt)("admonition",{title:"Config file",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"For best practices, avoid storing connection parameters in the ",(0,a.kt)("inlineCode",{parentName:"p"},"deploy.php")," file, as\nthese can vary based on the deployment execution location. Instead, only include the\nhostname and remote_user in ",(0,a.kt)("inlineCode",{parentName:"p"},"deploy.php"),", while maintaining other parameters in the\n",(0,a.kt)("inlineCode",{parentName:"p"},"~/.ssh/config")," file."),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre"},"Host *\n  IdentityFile ~/.ssh/id_rsa\n"))),(0,a.kt)("h3",{id:"identity_file"},(0,a.kt)("inlineCode",{parentName:"h3"},"identity_file")),(0,a.kt)("p",null,"For example, ",(0,a.kt)("inlineCode",{parentName:"p"},"~/.ssh/id_rsa"),"."),(0,a.kt)("h3",{id:"forward_agent"},(0,a.kt)("inlineCode",{parentName:"h3"},"forward_agent")),(0,a.kt)("p",null,"SSH forwarding is a way to securely tunnel network connections from your local computer to a remote server, and from the remote server to another destination. There are several types of SSH forwarding, including local, remote, and dynamic forwarding. SSH agent forwarding is a specific type of local forwarding that allows you to use your local SSH keys to authenticate on remote servers. This can be useful if you want to use your local SSH keys to connect to a remote server, but don't want to copy your keys to the remote server."),(0,a.kt)("p",null,"Default is ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,a.kt)("h3",{id:"ssh_multiplexing"},(0,a.kt)("inlineCode",{parentName:"h3"},"ssh_multiplexing")),(0,a.kt)("p",null,"SSH multiplexing is a technique that allows a single Secure Shell (SSH) connection to be used for multiple interactive sessions or for multiple tunneled connections. This can be useful in a number of situations, such as when you want to open multiple terminal sessions to a remote server over a single SSH connection, or when you want to establish multiple secure connections to a remote server but don't want to open multiple SSH connections."),(0,a.kt)("p",null,"Default is ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,a.kt)("h3",{id:"shell"},(0,a.kt)("inlineCode",{parentName:"h3"},"shell")),(0,a.kt)("p",null,"Default is ",(0,a.kt)("inlineCode",{parentName:"p"},"bash -ls"),"."),(0,a.kt)("h3",{id:"deploy_path"},(0,a.kt)("inlineCode",{parentName:"h3"},"deploy_path")),(0,a.kt)("p",null,"For example, ",(0,a.kt)("inlineCode",{parentName:"p"},"~/myapp"),"."),(0,a.kt)("h3",{id:"labels"},(0,a.kt)("inlineCode",{parentName:"h3"},"labels")),(0,a.kt)("p",null,"Key-value pairs for host selector."),(0,a.kt)("h3",{id:"ssh_arguments"},(0,a.kt)("inlineCode",{parentName:"h3"},"ssh_arguments")),(0,a.kt)("p",null,"For example, ",(0,a.kt)("inlineCode",{parentName:"p"},"['-o UserKnownHostsFile=/dev/null']")),(0,a.kt)("h3",{id:"ssh_control_path"},(0,a.kt)("inlineCode",{parentName:"h3"},"ssh_control_path")),(0,a.kt)("p",null,"Default is ",(0,a.kt)("inlineCode",{parentName:"p"},"~/.ssh/%C"),"."),(0,a.kt)("p",null,"If ",(0,a.kt)("strong",{parentName:"p"},"CI")," env is present, default value is ",(0,a.kt)("inlineCode",{parentName:"p"},"/dev/shm/%C"),"."),(0,a.kt)("h2",{id:"multiple-hosts"},"Multiple hosts"),(0,a.kt)("p",null,"You can pass multiple hosts to the host function:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"host('example.org', 'deployer.org', ...)\n    ->setRemoteUser('anton');\n")),(0,a.kt)("h2",{id:"host-ranges"},"Host ranges"),(0,a.kt)("p",null,"If you have a lot of hosts following similar patterns, you can describe them\nlike this rather than listing each hostname:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"host('www[01:50].example.org');\n")),(0,a.kt)("p",null,"For numeric patterns, leading zeros can be included or removed, as desired.\nRanges are inclusive."),(0,a.kt)("p",null,"You can also define alphabetic ranges:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"host('db[a:f].example.org');\n")),(0,a.kt)("h2",{id:"localhost"},"Localhost"),(0,a.kt)("p",null,"The ",(0,a.kt)("a",{parentName:"p",href:"/docs/7.x/api#localhost"},"localhost()")," function defines a special local host.\nDeployer will not connect to this host, but will execute commands locally instead."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},'localhost(); // Alias and hostname will be "localhost".\nlocalhost(\'ci\'); // Alias is "ci", hostname is "localhost".\n')),(0,a.kt)("h2",{id:"yaml-inventory"},"YAML Inventory"),(0,a.kt)("p",null,"You can use the ",(0,a.kt)("a",{parentName:"p",href:"/docs/7.x/api#import"},"import()")," function to keep host definitions in a\nseparate file. For example, ",(0,a.kt)("em",{parentName:"p"},"inventory.yaml"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="deploy.php"',title:'"deploy.php"'},"import('inventory.yaml');\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="inventory.yaml"',title:'"inventory.yaml"'},"hosts:\n  example.org:\n    remote_user: deployer\n  deployer.org:\n    remote_user: deployer\n")))}d.isMDXComponent=!0}}]);