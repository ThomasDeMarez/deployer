"use strict";(self.webpackChunkdeployer_docs=self.webpackChunkdeployer_docs||[]).push([[7079],{4137:(e,t,a)=>{a.d(t,{Zo:()=>i,kt:()=>d});var r=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function m(e,t){if(null==e)return{};var a,r,o=function(e,t){if(null==e)return{};var a,r,o={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var p=r.createContext({}),s=function(e){var t=r.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},i=function(e){var t=s(e.components);return r.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var a=e.components,o=e.mdxType,n=e.originalType,p=e.parentName,i=m(e,["components","mdxType","originalType","parentName"]),c=s(a),d=o,h=c["".concat(p,".").concat(d)]||c[d]||u[d]||n;return a?r.createElement(h,l(l({ref:t},i),{},{components:a})):r.createElement(h,l({ref:t},i))}));function d(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var n=a.length,l=new Array(n);l[0]=c;var m={};for(var p in t)hasOwnProperty.call(t,p)&&(m[p]=t[p]);m.originalType=e,m.mdxType="string"==typeof e?e:o,l[1]=m;for(var s=2;s<n;s++)l[s]=a[s];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}c.displayName="MDXCreateElement"},7797:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>u,frontMatter:()=>n,metadata:()=>m,toc:()=>s});var r=a(7462),o=(a(7294),a(4137));const n={},l="Mattermost Recipe",m={unversionedId:"contrib/mattermost",id:"contrib/mattermost",title:"Mattermost Recipe",description:"Source",source:"@site/docs/contrib/mattermost.md",sourceDirName:"contrib",slug:"/contrib/mattermost",permalink:"/docs/7.x/contrib/mattermost",draft:!1,editUrl:"https://github.com/deployphp/deployer/edit/master/docs/contrib/mattermost.md",tags:[],version:"current",frontMatter:{},sidebar:"contrib",previous:{title:"Ispmanager Recipe",permalink:"/docs/7.x/contrib/ispmanager"},next:{title:"Ms-teams Recipe",permalink:"/docs/7.x/contrib/ms-teams"}},p={},s=[{value:"Installing",id:"installing",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Usage",id:"usage",level:2},{value:"Configuration",id:"configuration-1",level:2},{value:"mattermost_webhook",id:"mattermost_webhook",level:3},{value:"mattermost_channel",id:"mattermost_channel",level:3},{value:"mattermost_username",id:"mattermost_username",level:3},{value:"mattermost_icon_url",id:"mattermost_icon_url",level:3},{value:"mattermost_success_emoji",id:"mattermost_success_emoji",level:3},{value:"mattermost_failure_emoji",id:"mattermost_failure_emoji",level:3},{value:"mattermost_text",id:"mattermost_text",level:3},{value:"mattermost_success_text",id:"mattermost_success_text",level:3},{value:"mattermost_failure_text",id:"mattermost_failure_text",level:3},{value:"Tasks",id:"tasks",level:2},{value:"mattermost:notify",id:"mattermostnotify",level:3},{value:"mattermost:notify:success",id:"mattermostnotifysuccess",level:3},{value:"mattermost:notify:failure",id:"mattermostnotifyfailure",level:3}],i={toc:s};function u(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,r.Z)({},i,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"mattermost-recipe"},"Mattermost Recipe"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"require 'contrib/mattermost.php';\n")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/tree/master/contrib/mattermost.php"},"Source")),(0,o.kt)("h2",{id:"installing"},"Installing"),(0,o.kt)("p",null,"Create a Mattermost incoming webhook, through the administration panel."),(0,o.kt)("p",null,"Add hook on deploy:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"before('deploy', 'mattermost:notify');\n")),(0,o.kt)("h2",{id:"configuration"},"Configuration"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"mattermost_webhook")," - incoming mattermost webook ",(0,o.kt)("strong",{parentName:"p"},"required")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"set('mattermost_webook', 'https://{your-mattermost-site}/hooks/xxx-generatedkey-xxx');\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"mattermost_channel")," - overrides the channel the message posts in"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"set('mattermost_channel', 'town-square');\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"mattermost_username")," - overrides the username the message posts as"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"set('mattermost_username', 'deployer');\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"mattermost_icon_url")," - overrides the profile picture the message posts with"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"set('mattermost_icon_url', 'https://domain.com/your-icon.png');\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"mattermost_text")," - notification message"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"set('mattermost_text', '_{{user}}_ deploying `{{branch}}` to **{{target}}**');\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"mattermost_success_text")," \u2013 success template, default:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"set('mattermost_success_text', 'Deploy to **{{target}}** successful {{mattermost_success_emoji}}');\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"mattermost_failure_text")," \u2013 failure template, default:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"set('mattermost_failure_text', 'Deploy to **{{target}}** failed {{mattermost_failure_emoji}}');\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"mattermost_success_emoji")," \u2013 emoji added at the end of success text")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"mattermost_failure_emoji")," \u2013 emoji added at the end of failure text"),(0,o.kt)("p",{parentName:"li"},"For detailed information about Mattermost hooks see: ",(0,o.kt)("a",{parentName:"p",href:"https://developers.mattermost.com/integrate/incoming-webhooks/"},"https://developers.mattermost.com/integrate/incoming-webhooks/")))),(0,o.kt)("h2",{id:"usage"},"Usage"),(0,o.kt)("p",null,"If you want to notify only about beginning of deployment add this line only:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"before('deploy', 'mattermost:notify');\n")),(0,o.kt)("p",null,"If you want to notify about successful end of deployment add this too:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"after('deploy:success', 'mattermost:notify:success');\n")),(0,o.kt)("p",null,"If you want to notify about failed deployment add this too:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"after('deploy:failed', 'mattermost:notify:failure');\n")),(0,o.kt)("h2",{id:"configuration-1"},"Configuration"),(0,o.kt)("h3",{id:"mattermost_webhook"},"mattermost_webhook"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/mattermost.php#L80"},"Source")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"null\n")),(0,o.kt)("h3",{id:"mattermost_channel"},"mattermost_channel"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/mattermost.php#L81"},"Source")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"null\n")),(0,o.kt)("h3",{id:"mattermost_username"},"mattermost_username"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/mattermost.php#L82"},"Source")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"'deployer'\n")),(0,o.kt)("h3",{id:"mattermost_icon_url"},"mattermost_icon_url"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/mattermost.php#L83"},"Source")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"null\n")),(0,o.kt)("h3",{id:"mattermost_success_emoji"},"mattermost_success_emoji"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/mattermost.php#L85"},"Source")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"':&#8203;white_check_mark:'\n")),(0,o.kt)("h3",{id:"mattermost_failure_emoji"},"mattermost_failure_emoji"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/mattermost.php#L86"},"Source")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"':&#8203;x:'\n")),(0,o.kt)("h3",{id:"mattermost_text"},"mattermost_text"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/mattermost.php#L88"},"Source")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"'_{{user}}_ deploying `{{branch}}` to **{{target}}**'\n")),(0,o.kt)("h3",{id:"mattermost_success_text"},"mattermost_success_text"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/mattermost.php#L89"},"Source")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"'Deploy to **{{target}}** successful {{mattermost_success_emoji}}'\n")),(0,o.kt)("h3",{id:"mattermost_failure_text"},"mattermost_failure_text"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/mattermost.php#L90"},"Source")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"'Deploy to **{{target}}** failed {{mattermost_failure_emoji}}'\n")),(0,o.kt)("h2",{id:"tasks"},"Tasks"),(0,o.kt)("h3",{id:"mattermostnotify"},"mattermost:notify"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/mattermost.php#L93"},"Source")),(0,o.kt)("p",null,"Notifies mattermost."),(0,o.kt)("h3",{id:"mattermostnotifysuccess"},"mattermost:notify:success"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/mattermost.php#L114"},"Source")),(0,o.kt)("p",null,"Notifies mattermost about deploy finish."),(0,o.kt)("h3",{id:"mattermostnotifyfailure"},"mattermost:notify:failure"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/mattermost.php#L135"},"Source")),(0,o.kt)("p",null,"Notifies mattermost about deploy failure."))}u.isMDXComponent=!0}}]);