"use strict";(self.webpackChunkdeployer_docs=self.webpackChunkdeployer_docs||[]).push([[209],{4137:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>m});var o=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var p=o.createContext({}),s=function(e){var t=o.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},d=function(e){var t=s(e.components);return o.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var r=e.components,n=e.mdxType,a=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(r),m=n,f=u["".concat(p,".").concat(m)]||u[m]||c[m]||a;return r?o.createElement(f,i(i({ref:t},d),{},{components:r})):o.createElement(f,i({ref:t},d))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=r.length,i=new Array(a);i[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:n,i[1]=l;for(var s=2;s<a;s++)i[s]=r[s];return o.createElement.apply(null,i)}return o.createElement.apply(null,r)}u.displayName="MDXCreateElement"},8169:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>c,frontMatter:()=>a,metadata:()=>l,toc:()=>s});var o=r(7462),n=(r(7294),r(4137));const a={},i="Discord Recipe",l={unversionedId:"contrib/discord",id:"contrib/discord",title:"Discord Recipe",description:"Source",source:"@site/docs/contrib/discord.md",sourceDirName:"contrib",slug:"/contrib/discord",permalink:"/docs/7.x/contrib/discord",draft:!1,editUrl:"https://github.com/deployphp/deployer/edit/master/docs/contrib/discord.md",tags:[],version:"current",frontMatter:{},sidebar:"contrib",previous:{title:"Directadmin Recipe",permalink:"/docs/7.x/contrib/directadmin"},next:{title:"Grafana Recipe",permalink:"/docs/7.x/contrib/grafana"}},p={},s=[{value:"Installing",id:"installing",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Usage",id:"usage",level:2},{value:"Configuration",id:"configuration-1",level:2},{value:"discord_webhook",id:"discord_webhook",level:3},{value:"discord_notify_text",id:"discord_notify_text",level:3},{value:"discord_success_text",id:"discord_success_text",level:3},{value:"discord_failure_text",id:"discord_failure_text",level:3},{value:"discord_message",id:"discord_message",level:3},{value:"Tasks",id:"tasks",level:2},{value:"discord_send_message",id:"discord_send_message",level:3},{value:"discord:test",id:"discordtest",level:3},{value:"discord:notify",id:"discordnotify",level:3},{value:"discord:notify:success",id:"discordnotifysuccess",level:3},{value:"discord:notify:failure",id:"discordnotifyfailure",level:3}],d={toc:s};function c(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,o.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"discord-recipe"},"Discord Recipe"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php"},"require 'contrib/discord.php';\n")),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/tree/master/contrib/discord.php"},"Source")),(0,n.kt)("h2",{id:"installing"},"Installing"),(0,n.kt)("p",null,"Add hook on deploy:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php"},"before('deploy', 'discord:notify');\n")),(0,n.kt)("h2",{id:"configuration"},"Configuration"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"p"},"discord_channel")," \u2013 Discord channel ID, ",(0,n.kt)("strong",{parentName:"p"},"required"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"p"},"discord_token")," \u2013 Discord channel token, ",(0,n.kt)("strong",{parentName:"p"},"required"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"p"},"discord_notify_text")," \u2013 notification message template, markdown supported, default:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-markdown"},":&#8203;information_source: **{{user}}** is deploying branch `{{branch}}` to _{{target}}_\n"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"p"},"discord_success_text")," \u2013 success template, default:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-markdown"},":&#8203;white_check_mark: Branch `{{branch}}` deployed to _{{target}}_ successfully\n"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"p"},"discord_failure_text")," \u2013 failure template, default:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-markdown"},":&#8203;no_entry_sign: Branch `{{branch}}` has failed to deploy to _{{target}}_\n")))),(0,n.kt)("h2",{id:"usage"},"Usage"),(0,n.kt)("p",null,"If you want to notify only about beginning of deployment add this line only:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php"},"before('deploy', 'discord:notify');\n")),(0,n.kt)("p",null,"If you want to notify about successful end of deployment add this too:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php"},"after('deploy:success', 'discord:notify:success');\n")),(0,n.kt)("p",null,"If you want to notify about failed deployment add this too:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php"},"after('deploy:failed', 'discord:notify:failure');\n")),(0,n.kt)("h2",{id:"configuration-1"},"Configuration"),(0,n.kt)("h3",{id:"discord_webhook"},"discord_webhook"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/discord.php#L53"},"Source")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"return 'https://discordapp.com/api/webhooks/{{discord_channel}}/{{discord_token}}/slack';\n")),(0,n.kt)("h3",{id:"discord_notify_text"},"discord_notify_text"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/discord.php#L58"},"Source")),(0,n.kt)("p",null,"Deploy messages"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"return [\n'text' => parse(':&#8203;information_source: **{{user}}** is deploying branch `{{branch}}` to _{{target}}_'),\n];\n")),(0,n.kt)("h3",{id:"discord_success_text"},"discord_success_text"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/discord.php#L63"},"Source")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"return [\n'text' => parse(':&#8203;white_check_mark: Branch `{{branch}}` deployed to _{{target}}_ successfully'),\n];\n")),(0,n.kt)("h3",{id:"discord_failure_text"},"discord_failure_text"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/discord.php#L68"},"Source")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"return [\n'text' => parse(':&#8203;no_entry_sign: Branch `{{branch}}` has failed to deploy to _{{target}}_'),\n];\n")),(0,n.kt)("h3",{id:"discord_message"},"discord_message"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/discord.php#L75"},"Source")),(0,n.kt)("p",null,"The message"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Default value"',title:'"Default','value"':!0},"'discord_notify_text'\n")),(0,n.kt)("h2",{id:"tasks"},"Tasks"),(0,n.kt)("h3",{id:"discord_send_message"},"discord_send_message"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/discord.php#L78"},"Source")),(0,n.kt)("p",null,"Helpers"),(0,n.kt)("h3",{id:"discordtest"},"discord:test"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/discord.php#L86"},"Source")),(0,n.kt)("p",null,"Tests messages."),(0,n.kt)("p",null,"Tasks"),(0,n.kt)("h3",{id:"discordnotify"},"discord:notify"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/discord.php#L97"},"Source")),(0,n.kt)("p",null,"Notifies Discord."),(0,n.kt)("h3",{id:"discordnotifysuccess"},"discord:notify:success"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/discord.php#L105"},"Source")),(0,n.kt)("p",null,"Notifies Discord about deploy finish."),(0,n.kt)("h3",{id:"discordnotifyfailure"},"discord:notify:failure"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/deployphp/deployer/blob/master/contrib/discord.php#L113"},"Source")),(0,n.kt)("p",null,"Notifies Discord about deploy failure."))}c.isMDXComponent=!0}}]);